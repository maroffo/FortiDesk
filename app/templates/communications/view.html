{% extends "base.html" %}

{% block title %}{{ announcement.subject }} - FortiDesk{% endblock %}

{% block content %}
<h1>{{ announcement.subject }}</h1>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-3">
            <div class="card-header">{{ _('Details') }}</div>
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-sm-3"><strong>{{ _('Type') }}:</strong></div>
                    <div class="col-sm-9">
                        {% if announcement.announcement_type == 'general' %}
                            <span class="badge bg-primary">{{ _('General') }}</span>
                        {% elif announcement.announcement_type == 'training' %}
                            <span class="badge bg-info">{{ _('Training') }}</span>
                        {% elif announcement.announcement_type == 'match' %}
                            <span class="badge bg-warning text-dark">{{ _('Match') }}</span>
                        {% elif announcement.announcement_type == 'administrative' %}
                            <span class="badge bg-secondary">{{ _('Administrative') }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-3"><strong>{{ _('Team') }}:</strong></div>
                    <div class="col-sm-9">{{ announcement.team.name if announcement.team else _('All Teams') }}</div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-3"><strong>{{ _('Created by') }}:</strong></div>
                    <div class="col-sm-9">{{ announcement.creator.get_full_name() }}</div>
                </div>
                <div class="row mb-2">
                    <div class="col-sm-3"><strong>{{ _('Created at') }}:</strong></div>
                    <div class="col-sm-9">{{ announcement.created_at.strftime('%d/%m/%Y %H:%M') }}</div>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">{{ _('Content') }}</div>
            <div class="card-body">
                <p style="white-space: pre-wrap;">{{ announcement.body }}</p>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header">{{ _('Email Delivery') }}</div>
            <div class="card-body">
                {% if announcement.email_sent_at %}
                    <p><span class="text-success">&#10003;</span> {{ _('Email sent') }}</p>
                    <p><strong>{{ _('Sent at') }}:</strong> {{ announcement.email_sent_at.strftime('%d/%m/%Y %H:%M') }}</p>
                    <p><strong>{{ _('Recipients') }}:</strong> {{ announcement.recipient_count }}</p>
                {% else %}
                    <p><span class="text-muted">&#10007;</span> {{ _('Email not sent') }}</p>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">{{ _('Actions') }}</div>
            <div class="card-body">
                {% if current_user.is_admin() or current_user.is_coach() %}
                <form method="POST" action="{{ url_for('communications.send', id=announcement.id) }}" class="mb-2">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-success w-100" onclick="return confirm('{{ _('Send email to all relevant recipients?') }}')">
                        {% if announcement.email_sent_at %}
                            {{ _('Resend Email') }}
                        {% else %}
                            {{ _('Send Email') }}
                        {% endif %}
                    </button>
                </form>
                {% endif %}

                {% if current_user.is_admin() %}
                <form method="POST" action="{{ url_for('communications.delete', id=announcement.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-danger w-100" onclick="return confirm('{{ _('Are you sure you want to delete this announcement?') }}')">
                        {{ _('Delete') }}
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<a href="{{ url_for('communications.index') }}" class="btn btn-secondary mt-3">{{ _('Back to Communications') }}</a>
{% endblock %}
