{% extends "base.html" %}

{% block title %}{{ session.title }} - FortiDesk{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ session.title }}</h1>
    <div>
        {% if not session.cancelled %}
        <a href="{{ url_for('training.check_in', id=session.id) }}" class="btn btn-success me-2">
            <i class="bi bi-check2-square"></i> {{ _('Check-In') }}
        </a>
        {% endif %}
        {% if current_user.is_admin() or current_user.is_coach() %}
        <a href="{{ url_for('training.edit', id=session.id) }}" class="btn btn-primary me-2">
            <i class="bi bi-pencil"></i> {{ _('Edit') }}
        </a>
        {% endif %}
        {% if current_user.is_admin() %}
        <form method="POST" action="{{ url_for('training.delete', id=session.id) }}" class="d-inline" onsubmit="return confirm('{{ _('Are you sure you want to delete this session?') }}');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash"></i> {{ _('Delete') }}
            </button>
        </form>
        {% endif %}
    </div>
</div>

<!-- Status Banner -->
{% if session.cancelled %}
<div class="alert alert-danger">
    <strong>{{ _('This session has been cancelled.') }}</strong>
    {% if session.cancellation_reason %}
    <p class="mb-0 mt-1">{{ _('Reason') }}: {{ session.cancellation_reason }}</p>
    {% endif %}
</div>
{% endif %}

<div class="row">
    <!-- Session Details -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5>{{ _('Session Details') }}</h5>
            </div>
            <div class="card-body">
                <p>
                    <strong>{{ _('Date') }}:</strong> {{ session.date.strftime('%d/%m/%Y') }}
                    {% if session.cancelled %}
                        <span class="badge bg-danger">{{ _('Cancelled') }}</span>
                    {% elif session.is_past() %}
                        <span class="badge bg-secondary">{{ _('Past') }}</span>
                    {% else %}
                        <span class="badge bg-success">{{ _('Upcoming') }}</span>
                    {% endif %}
                </p>
                <p><strong>{{ _('Time') }}:</strong> {{ session.start_time.strftime('%H:%M') }} - {{ session.end_time.strftime('%H:%M') }}</p>
                <p><strong>{{ _('Duration') }}:</strong> {{ session.duration_minutes() }} {{ _('minutes') }}</p>
                <p><strong>{{ _('Type') }}:</strong>
                    <span class="badge bg-info">{{ session.get_session_type_display() }}</span>
                </p>
                {% if session.location %}
                <p><strong>{{ _('Location') }}:</strong> {{ session.location }}</p>
                {% endif %}
                {% if session.is_recurring %}
                <p><strong>{{ _('Recurring') }}:</strong> {{ _('Yes') }}</p>
                {% endif %}
                <p><strong>{{ _('Created') }}:</strong> {{ session.created_at.strftime('%d/%m/%Y %H:%M') }}</p>
            </div>
        </div>
    </div>

    <!-- Team and Coach -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5>{{ _('Team & Coach') }}</h5>
            </div>
            <div class="card-body">
                <p>
                    <strong>{{ _('Team') }}:</strong>
                    <a href="{{ url_for('teams.view', id=session.team.id) }}">{{ session.team.name }}</a>
                </p>
                {% if session.coach %}
                <p>
                    <strong>{{ _('Coach') }}:</strong>
                    <a href="{{ url_for('staff.detail', id=session.coach.id) }}">{{ session.coach.get_full_name() }}</a>
                </p>
                {% else %}
                <p><strong>{{ _('Coach') }}:</strong> <span class="text-muted">{{ _('Not assigned') }}</span></p>
                {% endif %}
                {% if session.season %}
                <p><strong>{{ _('Season') }}:</strong> {{ session.season.name }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Notes -->
{% if session.notes %}
<div class="row">
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5>{{ _('Notes') }}</h5>
            </div>
            <div class="card-body">
                <p>{{ session.notes }}</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Cancel Session (if not already cancelled) -->
{% if not session.cancelled and (current_user.is_admin() or current_user.is_coach()) %}
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card border-warning">
            <div class="card-header bg-warning bg-opacity-10">
                <h5>{{ _('Cancel Session') }}</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('training.cancel', id=session.id) }}" onsubmit="return confirm('{{ _('Are you sure you want to cancel this session?') }}');">
                    {{ cancel_form.hidden_tag() }}
                    <div class="mb-3">
                        {{ cancel_form.cancellation_reason.label(class="form-label") }}
                        {{ cancel_form.cancellation_reason(class="form-control", rows=2) }}
                    </div>
                    {{ cancel_form.submit(class="btn btn-warning") }}
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="mt-3">
    <a href="{{ url_for('training.index') }}" class="btn btn-secondary">{{ _('Back to Training Sessions') }}</a>
</div>
{% endblock %}
